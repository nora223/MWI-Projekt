<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="de" lang="de-de">
    <head>
        <title>Map | Testanwendung</title>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
        <meta http-equiv="content-script-type" content="text/javascript" />
        <meta http-equiv="content-style-type" content="text/css" />
        <meta http-equiv="content-language" content="de" />
        <link rel="stylesheet" type="text/css" href="map.css"></link>
        <!--[if IE]>
        <link rel="stylesheet" type="text/css" href="ie_map.css"></link>
        <![endif]-->
        <script type="text/javascript" src="http://www.openlayers.org/api/OpenLayers.js"></script>
        <script type="text/javascript" src="http://www.openstreetmap.org/openlayers/OpenStreetMap.js"></script>
        <script type="text/javascript" src="tom.js"></script>
        <script type="text/javascript" src="test.js"></script>
        <script type="text/javascript" src="menu/showCoordinate.js"></script>
        <script type="text/javascript">
            //<![CDATA[

            var map;
            var layer_mapnik;
            var layer_tah;
            var layer_markers;
            var getLon = null;


//            function timedRefresh(timeoutPeriod) {
//                setTimeout("location.reload(true);", timeoutPeriod);
//            }
            function drawmap() {
                // Popup und Popuptext mit evtl. Grafik
                //var popuptext = "<font color=\"black\"><b>DHBW Karlsruhe<br>Erzbergerstra&szlig;e 121<br>76133 Karlsruhe</b><p><img src=\"dhbw.jpg\" width=\"180\" height=\"113\"></p></font>";

                OpenLayers.Lang.setCode('de');

                // Position und Zoomstufe der Karte
                var lon = 7.96966776;
                var lat = 50.56001016;
                var zoom = 18;

                map = new OpenLayers.Map('map', {
                    projection: new OpenLayers.Projection("EPSG:900913"),
                    displayProjection: new OpenLayers.Projection("EPSG:4326"),
                    controls: [
                        new OpenLayers.Control.Navigation(),
                    ],
                    maxExtent:
                            new OpenLayers.Bounds(-20037508.34, -20037508.34,
                                    20037508.34, 20037508.34),
                    numZoomLevels: 18,
                    maxResolution: 156543,
                    units: 'meters'
                });

                layer_mapnik = new OpenLayers.Layer.OSM.Mapnik("Mapnik");
                layer_markers = new OpenLayers.Layer.Markers("Address", {projection: new OpenLayers.Projection("EPSG:4326"),
                    visibility: true, displayInLayerSwitcher: false});

                //getLon = getLongitude();
                //getLat = coordinates[1];
                //coordinates[1] = showcoordinate.getLatitude();

                //if (getLon != null) {
                //popuptext = getLon + "<font color=\"black\"><b>WOOOP WOOP<br>Erzbergerstra&szlig;e 121<br>76133 Karlsruhe</b><p><img src=\"dhbw.jpg\" width=\"180\" height=\"113\"></p></font>";
                map.addLayers([layer_mapnik, layer_markers]);
                jumpTo(lon, lat, zoom);
                // Position des Markers
                addMarker(layer_markers, 8.38573, 49.02640, popuptext);


                //} else {
                //    popuptext = "<font color=\"black\"><b>Test<br>Erzbergerstra&szlig;e 121<br>76133 Karlsruhe</b><p><img src=\"dhbw.jpg\" width=\"180\" height=\"113\"></p></font>";
                //    map.addLayers([layer_mapnik, layer_markers]);
                //    jumpTo(lon, lat, zoom);

                // Position des Markers
                //    addMarker(layer_markers, 8.38573, 49.02640, popuptext);

                //}
            }
            function test() {
                var lon = 7.96966776;
                var lat = 50.56001016;
                //var pixel = new map.getPixelFromLonLat(7.96966776, 50.56001016);
                //var lonlat = map.getLonLatFromViewPortPx(pixel);

                var newPx = map.getLayerPxFromViewPortPx(map.getPixelFromLonLat(new OpenLayers.LonLat(lon, lat).transform(map.displayProjection, map.projection)));
                //funktionier mit falschen Koordinaten
                //var pixel = new OpenLayers.Pixel();
                //var lonlat = map.getLonLatFromPixel(pixel);


                return newPx;
            }
            function getCoordinate(x, y) {
                var pixel = new OpenLayers.Pixel(x, y);
                var coordinate = map.getLonLatFromPixel(pixel);
                coordinate.transform(new OpenLayers.Projection("EPSG:900913"), new OpenLayers.Projection("EPSG:4326"));
                return coordinate;

            }
            function goTo(newLon, newLat) {
                lon = newLon;
                lat = newLat;
                zoom = 18;
                jumpTo(lon, lat, zoom);
            }
            function createArrayLonLat(pixelCounter) {
                lonArray = new Array(pixelCounter);
                latArray = new Array(pixelCounter);
                //zonaBLng = new Array(pixelCounter);
                //zonaBLat = new Array(pixelCounter);

            }
            counter = 0;
            function setLonLatArrays(lon, lat, i) {
                counter = i;
                lonArray[i] = lon;
                latArray[i] = lat;
                //zonaBLng[i]=lon;
                //zonaBLat[i]=lat;
                return lonArray;
            }
            
            function getfirstCoordinate(lon, lat){
                CoordinatLon = lon;
                CooridnatLat = lat;
            }
            
            function pintarZonas() {
                /* var zonaBLng;
                 var zonaBLat;
                 var counter = pixelCounter;
                 var helpLat = 0;
                 var helpLon;
                 
                 for (var i = 0; i < counter; i++) {
                 //helpLon = lon[i];
                 //helpLat = lat[i];
                 //zonaBLng[i] = helpLon;
                 //zonaBLat[i] = helpLat;
                 //helpLat = helpLat + 1;
                 }*/
                var zoneALng = [-3.841867446899414, -3.838176727294922, -3.838348388671875,    -3.843669891357422];
                var zoneALat = [latArray];
                var zoneBLng = [lonArray];
                var zoneBLat = [latArray];
                
                //Angabe eines Laengen- und Breitengrades
                var lonLat = new OpenLayers.LonLat(CoordinatLon, CooridnatLat).transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject());
                map.zoomTo(15);
                map.setCenter(lonLat, 19);
                
                var vectorZonas = [zoneALng, zoneALat, zoneBLng, zoneBLat];

                lineLayerZona1 = new OpenLayers.Layer.Vector("zona1");
                style1 = {strokeColor: '#ff0000',
                    strokeOpacity: 1,
                    fillColor: '#ff0000',
                    strokeWidth: 2,
                    fillOpacity: 0.1
                };

                lineLayerZona2 = new OpenLayers.Layer.Vector("zo na2");
                style2 = {strokeColor: '#ff0000',
                    strokeOpacity: 1,
                    fillColor: '#ff0000',
                    strokeWidth: 2,
                    fillOpacity: 0.1
                };

                var vectorStyle = [style1, style2];
                var vectorLineLayer = [lineLayerZona1, lineLayerZona2];

                pointZona1 = new Array();
                pointZona2 = new Array();
                vectorPoint = [pointZona1, pointZona2];

                var i = 0;
                var x = 0;
                var zonaLat, zonaLng;
                var ww = 0;
                for (i = 0; i < vectorZonas.length / 2; i++) {
                    zonaLng = vectorZonas[ww];
                    zonaLat = vectorZonas[ww + 1];
                    point = vectorPoint[i];
                    ww = i;
                    ww += 2;
                    for (x = 0; x < zonaLng.length; x++) {
                        point[x] = new OpenLayers.LonLat(zonaLng[x], zonaLat[x]).transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject());

                        point[x] = new OpenLayers.Geometry.Point(point[x].lon, point[x].lat);
                    }
                }

                for (z = 0; z < vectorPoint.length; z++) {
                    linear_ring = new OpenLayers.Geometry.LinearRing(vectorPoint[z]);
                    polygonFeature = new OpenLayers.Feature.Vector(
                            new OpenLayers.Geometry.Polygon([linear_ring]), null, vectorStyle[z]);

                    vectorLineLayer[z].addFeatures([polygonFeature]);
                    map.addLayer(vectorLineLayer[z]);

                }

                
            }
            //]]>
        </script>

    </head>
    <body onload="drawmap();"><!-- Refresh der Seite -->

        <div id="map">
        </div>

    </body>
</html>

